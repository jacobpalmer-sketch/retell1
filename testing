<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FITZ≈åNE ‚Ä¢ Luxury Fitness Analytics</title>

<!-- Single-file, $100k-feel luxury fitness dashboard. Paste as index.html and deploy. -->

<!-- CDNs (no build step) -->
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;800&family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#0a0d12; --bg2:#0c1017; --glass:rgba(255,255,255,.04);
    --ink:#eaeef7; --muted:#a9b4c9; --line:rgba(255,255,255,.075);
    --gold:#f5d189; --gold2:#e7c46c; --mint:#97ffd3; --aqua:#7ee5ff; --rose:#ff99c2;
    --ok:#89f5a6; --warn:#ffd480; --bad:#ff8a8a;
    --ring:0 0 0 1px var(--line), 0 8px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:radial-gradient(1600px 900px at 120% -10%, #0f1a28, transparent),
             radial-gradient(1200px 700px at -20% -20%, #0f1622, transparent),
             var(--bg); color:var(--ink); font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    overflow:hidden;
  }
  #scene{position:fixed; inset:0; z-index:0;}
  header{
    position:fixed; top:0; left:0; right:0; z-index:10;
    display:flex; align-items:center; justify-content:space-between; gap:16px;
    padding:18px 26px; backdrop-filter: blur(10px);
    background:linear-gradient(180deg, rgba(14,18,26,.7), rgba(14,18,26,.25));
    border-bottom:1px solid var(--line);
  }
  .brand{display:flex; align-items:center; gap:16px}
  .crest{
    width:42px; height:42px; border-radius:12px; position:relative; box-shadow: var(--ring);
    background:
      radial-gradient(60% 60% at 70% 30%, rgba(255,255,255,.22), transparent 60%),
      conic-gradient(from 200deg, #e7c46c, #97ffd3, #7ee5ff, #e7c46c);
  }
  .title{
    line-height:1.05; letter-spacing:.3px;
  }
  .title b{font-family:"Playfair Display", serif; font-weight:800; font-size:20px; letter-spacing:.4px}
  .title small{display:block; color:var(--muted); font-size:11.5px; margin-top:2px}
  .toolbar{display:flex; align-items:center; gap:10px}
  .btn{
    background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    border:1px solid var(--line); color:var(--ink); padding:9px 12px; border-radius:10px; cursor:pointer; box-shadow:var(--ring);
    font-size:12.5px; transition:.2s ease; backdrop-filter: blur(6px);
  }
  .btn:hover{transform:translateY(-1px); background:rgba(255,255,255,.08)}
  .btn.gold{border-color:rgba(245,209,137,.35); color:#201a0c; background:linear-gradient(180deg, #f8dfa9, #e9c66e);}
  .badge{
    display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; border:1px solid var(--line);
    background:rgba(255,255,255,.04); box-shadow:var(--ring); font-size:12px; color:var(--muted);
  }
  .grid{
    position:fixed; inset:80px 20px 20px; display:grid; grid-template-columns:320px 1fr; gap:18px; z-index:5;
  }
  aside{
    display:grid; grid-template-rows:auto 1fr auto; gap:16px; min-height:0;
  }
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02)); border:1px solid var(--line);
    border-radius:16px; box-shadow:var(--ring); padding:16px; overflow:hidden; backdrop-filter: blur(6px);
  }
  .lux{
    padding:16px 16px 14px; border-radius:16px; position:relative; overflow:hidden;
    background:
      radial-gradient(900px 300px at -20% -60%, rgba(231,196,108,.23), transparent 70%),
      radial-gradient(900px 300px at 120% -60%, rgba(151,255,211,.22), transparent 70%),
      linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
    border:1px solid rgba(231,196,108,.35);
  }
  .lux h2{
    margin:0 0 4px; font-family:"Playfair Display", serif; font-weight:800; letter-spacing:.3px; font-size:19px; color:#0f1114;
    background: linear-gradient(90deg,#1a202c,#3b3f49); -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  }
  .sub{color:var(--muted); font-size:12px}
  .stack{display:grid; gap:12px}
  .kpi{
    display:grid; grid-template-columns:1fr auto; gap:8px; padding:12px; border-radius:12px; border:1px solid var(--line);
    background:rgba(255,255,255,.03);
  }
  .kpi .name{font-size:12px; color:var(--muted)}
  .kpi .val{font-size:26px; font-weight:700}
  .kpi .trend{font-size:11.5px}
  .trend.up{color:var(--ok)} .trend.flat{color:var(--warn)} .trend.down{color:var(--bad)}
  .scroll{overflow:auto; min-height:0; max-height:100%}
  .list{width:100%; border-collapse:collapse; font-size:13px}
  .list th,.list td{padding:10px 10px; border-bottom:1px solid var(--line)}
  .list th{position:sticky; top:0; text-align:left; background:rgba(255,255,255,.04); backdrop-filter: blur(4px)}
  .status{padding:4px 9px; border-radius:999px; border:1px solid var(--line); font-size:11.5px}
  .s-active{background:rgba(137,245,166,.15); color:#bfffce; border-color:rgba(137,245,166,.35)}
  .s-suspended{background:rgba(255,138,138,.12); color:#ffc9c9; border-color:rgba(255,138,138,.35)}
  .s-expired{background:rgba(255,212,128,.12); color:#ffe4b8; border-color:rgba(255,212,128,.35)}
  .area{display:grid; grid-template-columns:1fr 1fr; gap:18px; min-height:0}
  .panel{min-height:0}
  .panel h3{
    margin:0 0 8px; font-family:"Playfair Display", serif; letter-spacing:.2px; font-size:18px;
    background: linear-gradient(90deg,#f5d189,#fff1cf); -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  }
  .toolbar{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
  .input{
    background:rgba(255,255,255,.04); border:1px solid var(--line); color:var(--ink);
    padding:9px 12px; border-radius:10px; outline:none; min-width:200px; box-shadow:var(--ring);
  }
  .pill{padding:7px 10px; border-radius:999px; border:1px solid var(--line); background:rgba(255,255,255,.04); cursor:pointer; font-size:12px}
  .pill.active{background:rgba(255,255,255,.08)}
  .toolbar .btn{height:36px}
  .dock{
    position:fixed; left:50%; bottom:14px; transform:translateX(-50%);
    display:flex; gap:10px; z-index:12;
  }
  .dock .btn{border-radius:999px}
  .toast{
    position:fixed; right:18px; top:84px; padding:10px 14px; background:rgba(14,18,26,.8);
    border:1px solid var(--line); border-radius:10px; z-index:15; font-size:12.5px; display:none;
  }
  .modal{
    position:fixed; inset:0; display:none; place-items:center; z-index:20;
    background:rgba(5,8,12,.55); backdrop-filter: blur(5px);
  }
  .sheet{
    width:min(680px,92vw); max-height:80vh; overflow:auto;
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03)); border:1px solid var(--line);
    border-radius:16px; box-shadow:var(--ring); padding:16px;
  }
  .sheet h3{margin:0 0 8px; font-family:"Playfair Display", serif}
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .seg{flex:1; min-width:220px}
  .notice{font-size:12px; color:var(--muted)}
  .divider{height:1px; background:var(--line); margin:10px 0}
</style>
</head>
<body>

<canvas id="scene"></canvas>

<header>
  <div class="brand">
    <div class="crest" aria-hidden="true"></div>
    <div class="title">
      <b>FITZ≈åNE</b>
      <small>Luxury Fitness Analytics ‚Ä¢ Real-time Insights ‚Ä¢ 3D Experience</small>
    </div>
  </div>
  <div class="toolbar">
    <span class="badge">üìà Rev (est.): <b id="revEst">$‚Äî</b></span>
    <button class="btn gold" id="voiceBtn">üéôÔ∏è Ask the Concierge</button>
    <button class="btn" id="exportCSV">Export CSV</button>
    <button class="btn" id="reseed">Reseed Demo</button>
    <button class="btn" id="theme">Theme</button>
  </div>
</header>

<div class="grid">
  <aside>
    <div class="card lux">
      <h2>Executive KPIs</h2>
      <div class="sub">Live health of membership & activity (simulated)</div>
      <div class="stack" id="kpis">
        <!-- KPIs injected -->
      </div>
    </div>

    <div class="card">
      <div class="row" style="justify-content:space-between;align-items:end;margin-bottom:8px">
        <div>
          <h3 style="margin:0;font-family:'Playfair Display',serif;color:var(--ink)">Upcoming Expiries (‚â§ 30 days)</h3>
          <div class="sub">Proactive retention list</div>
        </div>
        <input class="input" id="expSearch" placeholder="Search name/phone‚Ä¶" />
      </div>
      <div class="scroll" id="expList"><!-- table --></div>
    </div>

    <div class="card">
      <div class="row" style="justify-content:space-between;align-items:center">
        <div class="sub">Concierge Tips</div>
        <button class="btn" id="insightRefresh">New Insight</button>
      </div>
      <div id="insight" style="margin-top:8px; font-size:13.5px; line-height:1.5; color:var(--muted)">
        <!-- AI-ish insight -->
      </div>
    </div>
  </aside>

  <section class="area">
    <div class="card panel">
      <div class="row" style="justify-content:space-between;align-items:end;margin-bottom:8px">
        <div>
          <h3>Activity & Energy Burn</h3>
          <div class="sub">Active users vs. calories (k) ‚Äî monthly</div>
        </div>
        <div class="toolbar">
          <button class="btn" id="simulatePulse">Simulate Pulse</button>
        </div>
      </div>
      <canvas id="chartActivity" height="140"></canvas>
    </div>

    <div class="card panel">
      <div class="row" style="justify-content:space-between;align-items:end;margin-bottom:8px">
        <div>
          <h3>Plan Distribution & Status</h3>
          <div class="sub">Mix by month (Basic / Premium / VIP)</div>
        </div>
        <div class="toolbar">
          <div class="pill active" data-plan="All">All</div>
          <div class="pill" data-plan="Basic">Basic</div>
          <div class="pill" data-plan="Premium">Premium</div>
          <div class="pill" data-plan="VIP">VIP</div>
        </div>
      </div>
      <canvas id="chartPlans" height="140"></canvas>
    </div>

    <div class="card panel" style="grid-column:1/-1">
      <div class="row" style="justify-content:space-between;align-items:end;margin-bottom:8px">
        <div>
          <h3>Member Directory</h3>
          <div class="sub">Search, filter, edit inline, import/export</div>
        </div>
        <div class="toolbar">
          <input class="input" id="memSearch" placeholder="Search name/email/phone‚Ä¶" />
          <div class="pill active" data-s="All">All</div>
          <div class="pill" data-s="Active">Active</div>
          <div class="pill" data-s="Suspended">Suspended</div>
          <div class="pill" data-s="Expired">Expired</div>
          <button class="btn" id="addMember">Add</button>
          <button class="btn" id="importJSON">Import</button>
          <input type="file" id="fileJSON" accept="application/json" style="display:none" />
          <button class="btn" id="downloadJSON">Download JSON</button>
        </div>
      </div>
      <div class="scroll" id="memTable"><!-- table --></div>
    </div>
  </section>
</div>

<div class="dock">
  <button class="btn" id="simulateCheckins">Simulate Check-ins</button>
  <button class="btn" id="stopSim">Stop</button>
</div>

<div class="toast" id="toast"></div>

<!-- Member Modal -->
<div class="modal" id="modal">
  <div class="sheet">
    <h3>Member Profile</h3>
    <div class="sub">Edit details & simulate actions</div>
    <div class="divider"></div>
    <div class="row">
      <div class="seg">
        <label class="sub">Name</label>
        <input class="input" id="m_name" />
      </div>
      <div class="seg">
        <label class="sub">Email</label>
        <input class="input" id="m_email" />
      </div>
    </div>
    <div class="row" style="margin-top:8px">
      <div class="seg">
        <label class="sub">Phone (E.164)</label>
        <input class="input" id="m_phone" />
      </div>
      <div class="seg">
        <label class="sub">Plan</label>
        <input class="input" id="m_plan" />
      </div>
    </div>
    <div class="row" style="margin-top:8px">
      <div class="seg">
        <label class="sub">Status</label>
        <input class="input" id="m_status" />
      </div>
      <div class="seg">
        <label class="sub">Expiry (YYYY-MM-DD)</label>
        <input class="input" id="m_exp" />
      </div>
    </div>
    <div class="divider"></div>
    <div class="row">
      <button class="btn gold" id="m_save">Save</button>
      <button class="btn" id="m_suspend">Toggle Suspend</button>
      <button class="btn" id="m_close">Close</button>
      <span class="notice" id="m_note"></span>
    </div>
  </div>
</div>

<script>
/* =========================================================
   3D LUX BACKDROP
   ========================================================= */
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(65, innerWidth/innerHeight, 0.1, 100);
const renderer = new THREE.WebGLRenderer({canvas:document.getElementById('scene'), antialias:true, alpha:true});
renderer.setSize(innerWidth, innerHeight); camera.position.z=6;

const knot = new THREE.Mesh(
  new THREE.TorusKnotGeometry(1, .28, 200, 32),
  new THREE.MeshPhysicalMaterial({color:0xf5d189, metalness:.85, roughness:.25, transmission:.0, reflectivity:1})
);
scene.add(knot);
const p1 = new THREE.PointLight(0xffe3a6, 1.2); p1.position.set(5,5,6); scene.add(p1);
const p2 = new THREE.PointLight(0x9ffff0, 1.0); p2.position.set(-6,-5,-2); scene.add(p2);

let mx=0,my=0;
addEventListener('mousemove',e=>{mx=(e.clientX/innerWidth-.5); my=(e.clientY/innerHeight-.5);});
function tick(){
  requestAnimationFrame(tick);
  knot.rotation.x += 0.002 + my*0.01;
  knot.rotation.y += 0.003 + mx*0.01;
  renderer.render(scene,camera);
}
tick();
addEventListener('resize',()=>{camera.aspect=innerWidth/innerHeight; camera.updateProjectionMatrix(); renderer.setSize(innerWidth,innerHeight);});

/* =========================================================
   DATA ENGINE (localStorage + simulation)
   ========================================================= */
const LS_MEM = "fitzone.lux.members.v2";
const LS_CHK = "fitzone.lux.checkins.v2";

const first = ["Alex","Sophie","Jack","Ava","Noah","Isla","Liam","Mia","Lucas","Ella","Oliver","Charlotte","Henry","Amelia","Leo","Grace","Thomas","Zoe","Archie","Evie","Mateo","Luca","Aria","Ivy"];
const last  = ["Palmer","Reid","West","Nguyen","Brown","Taylor","Harris","Walker","White","Hall","Allen","Young","King","Wright","Scott","Green","Baker","Adams","Hill","Ward","Murphy","Wilson","Thompson","Clark"];
const plans = ["Basic","Premium","VIP"];
function e164(){ return "+61" + "4" + Math.floor(10000000+Math.random()*8999999) }
function fmt(d){ return new Date(d).toISOString().slice(0,10) }
function addDays(d, n){ const x=new Date(d); x.setDate(x.getDate()+n); return x }
function daysTo(a){ return Math.ceil((new Date(a)-new Date())/(1000*60*60*24)) }

function seedMembers(n=180){
  const arr = [];
  for(let i=1;i<=n;i++){
    const name = `${first[Math.floor(Math.random()*first.length)]} ${last[Math.floor(Math.random()*last.length)]}`;
    const email = name.toLowerCase().replace(/\s+/g,'.')+"@example.com";
    const phone = e164();
    const membership_type = plans[Math.floor(Math.random()*plans.length)];
    const join = new Date(2022,0,1).getTime() + Math.random()*(new Date(2025,10,1).getTime()-new Date(2022,0,1).getTime());
    const join_date = fmt(join);
    const expMonths = 6 + Math.floor(Math.random()*16);
    const exp = new Date(join_date); exp.setMonth(exp.getMonth()+expMonths);
    const expiry_date = fmt(exp);
    let status = "Active"; const left = daysTo(expiry_date);
    if(left < 0) status = "Expired"; else if(Math.random() < .12) status="Suspended";
    const last_checkin = fmt(addDays(new Date(), -Math.floor(Math.random()*90)));
    arr.push({id:i, name, email, phone, membership_type, status, join_date, last_checkin, expiry_date});
  }
  localStorage.setItem(LS_MEM, JSON.stringify(arr));
  localStorage.setItem(LS_CHK, JSON.stringify([]));
  return arr;
}
function loadMembers(){
  const raw = localStorage.getItem(LS_MEM);
  return raw ? JSON.parse(raw) : seedMembers(200);
}
function saveMembers(x){ localStorage.setItem(LS_MEM, JSON.stringify(x)) }
function loadCheckins(){ const raw = localStorage.getItem(LS_CHK); return raw? JSON.parse(raw) : [] }
function saveCheckins(x){ localStorage.setItem(LS_CHK, JSON.stringify(x)) }

let MEMBERS = loadMembers();
let CHECKINS = loadCheckins();

/* =========================================================
   KPI + REVENUE MODEL
   ========================================================= */
const PRICING = { Basic: 39, Premium: 69, VIP: 119 }; // AUD/mo
function computeKPIs(){
  const total = MEMBERS.length;
  const act = MEMBERS.filter(m=>m.status==="Active").length;
  const suspended = MEMBERS.filter(m=>m.status==="Suspended").length;
  const expired = MEMBERS.filter(m=>m.status==="Expired").length;
  const expSoon = MEMBERS.filter(m=>{ const d=daysTo(m.expiry_date); return d>=0 && d<=30 }).length;
  const avgSession = 40 + Math.floor(Math.random()*25);
  const avgCalories = 520 + Math.floor(Math.random()*180);
  // Revenue estimate
  const rev = MEMBERS.filter(m=>m.status==="Active").reduce((s,m)=>s+PRICING[m.membership_type],0);
  return { total, act, suspended, expired, expSoon, avgSession, avgCalories, rev };
}
function renderKPIs(){
  const k = computeKPIs();
  document.getElementById('kpis').innerHTML = `
    ${kpi("Total Members", k.total, "+3.1% MoM", "up")}
    ${kpi("Active", k.act, k.act>k.suspended? "+ healthy ratio" : "watchlist", k.act>k.suspended?"up":"flat")}
    ${kpi("Suspended", k.suspended, "recovery campaign", "flat")}
    ${kpi("Expired", k.expired, "reactivation opp.", "down")}
    ${kpi("Avg Session (min)", k.avgSession, "‚Üë quality time", "up")}
    ${kpi("Avg Calories", k.avgCalories, "‚Üë energy burn", "up")}
  `;
  document.getElementById('revEst').textContent = `A$ ${k.rev.toLocaleString()}/mo`;
}
function kpi(name,val,trend,mode){
  return `<div class="kpi">
    <div>
      <div class="name">${name}</div>
      <div class="val">${val.toLocaleString()}</div>
    </div>
    <div class="trend ${mode}">${trend}</div>
  </div>`;
}

/* =========================================================
   EXPIRIES LIST
   ========================================================= */
function renderExpiries(){
  const q = (document.getElementById('expSearch').value||"").toLowerCase();
  const rows = MEMBERS
    .filter(m=>{
      const d=daysTo(m.expiry_date);
      if(!(d>=0 && d<=30)) return false;
      return !q || m.name.toLowerCase().includes(q) || m.phone.includes(q);
    })
    .sort((a,b)=> new Date(a.expiry_date)-new Date(b.expiry_date));
  const html = table(rows, true);
  document.getElementById('expList').innerHTML = html || `<div class="sub">No expiries in next 30 days.</div>`;
}

/* =========================================================
   DIRECTORY
   ========================================================= */
const memSearch = document.getElementById('memSearch');
document.querySelectorAll('[data-s]').forEach(p=>p.addEventListener('click', ()=>{
  document.querySelectorAll('[data-s]').forEach(x=>x.classList.remove('active'));
  p.classList.add('active'); renderDirectory();
}));
memSearch.addEventListener('input', renderDirectory);

function renderDirectory(){
  const status = document.querySelector('[data-s].active').dataset.s;
  const q = (memSearch.value||"").toLowerCase();
  const rows = MEMBERS.filter(m=>{
    const okS = status==="All" || m.status===status;
    const okQ = !q || m.name.toLowerCase().includes(q) || m.email.toLowerCase().includes(q) || m.phone.includes(q);
    return okS && okQ;
  }).sort((a,b)=> a.name.localeCompare(b.name));
  document.getElementById('memTable').innerHTML = table(rows, false);
  bindTableActions();
}
function statusBadge(s){
  const cls = s==="Active"?"s-active": s==="Suspended"?"s-suspended":"s-expired";
  return `<span class="status ${cls}">${s}</span>`;
}
function table(rows, minimal){
  if(!rows.length) return "";
  const head = `
    <table class="list">
      <thead>
        <tr>
          <th>ID</th><th>Name</th><th>Email</th><th>Phone</th><th>Plan</th><th>Status</th><th>Joined</th><th>Last</th><th>Expiry</th>${minimal?"":"<th>Actions</th>"}
        </tr>
      </thead><tbody>`;
  const body = rows.map(m=>`
    <tr data-id="${m.id}">
      <td>${m.id}</td>
      <td class="cell" data-f="name">${m.name}</td>
      <td class="cell" data-f="email">${m.email}</td>
      <td class="cell" data-f="phone">${m.phone}</td>
      <td class="cell" data-f="membership_type">${m.membership_type}</td>
      <td>${statusBadge(m.status)}</td>
      <td class="cell" data-f="join_date">${m.join_date}</td>
      <td class="cell" data-f="last_checkin">${m.last_checkin}</td>
      <td class="cell" data-f="expiry_date">${m.expiry_date}</td>
      ${minimal?"":`
        <td>
          <button class="btn btn-sm open">Open</button>
          <button class="btn btn-sm tog">${m.status==="Active"?"Suspend":"Activate"}</button>
          <button class="btn btn-sm del">Remove</button>
        </td>`}
    </tr>`).join("");
  return head+body+`</tbody></table>`;
}
function bindTableActions(){
  document.querySelectorAll('.open').forEach(b=>b.onclick=()=>openMember(b));
  document.querySelectorAll('.tog').forEach(b=>b.onclick=()=>toggleMember(b));
  document.querySelectorAll('.del').forEach(b=>b.onclick=()=>removeMember(b));
  document.querySelectorAll('.cell').forEach(td=>{
    td.contentEditable = true;
    td.addEventListener('blur',()=>{
      const id = +td.closest('tr').dataset.id;
      const f = td.dataset.f; const val = td.textContent.trim();
      const i = MEMBERS.findIndex(x=>x.id===id); if(i>-1){ MEMBERS[i][f]=val; saveMembers(MEMBERS); toast("Saved."); renderKPIs(); }
    });
  });
}
function openMember(btn){
  const id = +btn.closest('tr').dataset.id;
  const m = MEMBERS.find(x=>x.id===id); if(!m) return;
  document.getElementById('m_name').value = m.name;
  document.getElementById('m_email').value = m.email;
  document.getElementById('m_phone').value = m.phone;
  document.getElementById('m_plan').value = m.membership_type;
  document.getElementById('m_status').value = m.status;
  document.getElementById('m_exp').value = m.expiry_date;
  document.getElementById('m_note').textContent = `Member #${m.id}`;
  document.getElementById('modal').style.display='grid';
  document.getElementById('m_save').onclick = ()=>{
    Object.assign(m,{
      name:document.getElementById('m_name').value.trim(),
      email:document.getElementById('m_email').value.trim(),
      phone:document.getElementById('m_phone').value.trim(),
      membership_type:document.getElementById('m_plan').value.trim(),
      status:document.getElementById('m_status').value.trim(),
      expiry_date:document.getElementById('m_exp').value.trim(),
    });
    saveMembers(MEMBERS); renderDirectory(); renderKPIs(); renderExpiries(); toast("Profile saved.");
  };
  document.getElementById('m_suspend').onclick = ()=>{
    m.status = m.status==="Active"?"Suspended":"Active"; saveMembers(MEMBERS); renderDirectory(); renderKPIs(); toast("Status toggled.");
  };
}
document.getElementById('m_close').onclick = ()=> document.getElementById('modal').style.display='none';
function toggleMember(btn){
  const id = +btn.closest('tr').dataset.id;
  const m = MEMBERS.find(x=>x.id===id); if(!m) return;
  m.status = m.status==="Active"?"Suspended":"Active"; saveMembers(MEMBERS); renderDirectory(); renderKPIs(); toast("Status updated.");
}
function removeMember(btn){
  const id = +btn.closest('tr').dataset.id;
  if(!confirm(`Remove member #${id}?`)) return;
  MEMBERS = MEMBERS.filter(x=>x.id!==id); saveMembers(MEMBERS); renderDirectory(); renderKPIs(); renderExpiries(); toast("Member removed.");
}
document.getElementById('addMember').onclick = ()=>{
  const id = MEMBERS.length? Math.max(...MEMBERS.map(m=>m.id))+1 : 1;
  const nm = prompt("Full name?"); if(!nm) return;
  const email = prompt("Email?", nm.toLowerCase().replace(/\s+/g,'.')+"@example.com");
  const phone = prompt("Phone (E.164)?", e164());
  const plan = prompt("Plan (Basic/Premium/VIP)?", "Basic");
  const join = fmt(new Date());
  const last = fmt(new Date());
  const exp  = fmt(addDays(new Date(), 180));
  const m = { id, name:nm, email, phone, membership_type:plan, status:"Active", join_date:join, last_checkin:last, expiry_date:exp };
  MEMBERS.push(m); saveMembers(MEMBERS); renderDirectory(); renderKPIs(); renderExpiries(); toast("Member added.");
};

/* =========================================================
   ANALYTICS CHARTS
   ========================================================= */
let chartA, chartP, PLAN_FILTER="All";
function genMonthly(){
  const out=[];
  for(let i=0;i<12;i++){
    out.push({
      label:new Date(2025,i).toLocaleString("default",{month:"short"}),
      active:200+Math.floor(Math.random()*300),
      calories:40000+Math.floor(Math.random()*12000),
      Basic:Math.floor(Math.random()*60)+20,
      Premium:Math.floor(Math.random()*90)+40,
      VIP:Math.floor(Math.random()*35)+10
    });
  }
  return out;
}
let SERIES = genMonthly();

function drawCharts(){
  const ctxA = document.getElementById('chartActivity'), ctxP = document.getElementById('chartPlans');
  if(chartA) chartA.destroy(); if(chartP) chartP.destroy();

  chartA = new Chart(ctxA, {
    type:'line',
    data:{
      labels:SERIESS().map(d=>d.label),
      datasets:[
        {label:'Active Users', data:SERIESS().map(d=>d.active), borderColor:"#97ffd3", backgroundColor:"rgba(151,255,211,.18)", fill:true, tension:.28},
        {label:'Calories (k)', data:SERIESS().map(d=>Math.round(d.calories/1000)), borderColor:"#f5d189", backgroundColor:"rgba(245,209,137,.18)", fill:true, tension:.28, yAxisID:'y1'}
      ]
    },
    options:{
      plugins:{legend:{labels:{color:"#e8eef7"}}},
      scales:{
        y:{ticks:{color:"#cfd8eb"}}, y1:{position:'right', grid:{drawOnChartArea:false}, ticks:{color:"#e3d4a6"}},
        x:{ticks:{color:"#cfd8eb"}}
      }
    }
  });

  const labels = SERIESS().map(d=>d.label);
  const ds = ["Basic","Premium","VIP"].map(p=>({
    label:p, data:SERIESS().map(d=>d[p]),
    backgroundColor: p==="Basic"?"#7ee5ff": p==="Premium"?"#97ffd3":"#ff99c2"
  })).filter(d=> PLAN_FILTER==="All" || d.label===PLAN_FILTER );

  chartP = new Chart(ctxP, {
    type:'bar',
    data:{ labels, datasets: ds },
    options:{
      plugins:{legend:{labels:{color:"#e8eef7"}}},
      scales:{x:{ticks:{color:"#cfd8eb"}}, y:{ticks:{color:"#cfd8eb"}}}
    }
  });
}
function SERIESS(){ return SERIES }

/* =========================================================
   VOICE CONCIERGE (Web Speech API)
   ========================================================= */
const speak = (t)=>{ try{ const u=new SpeechSynthesisUtterance(t); u.rate=1.02; speechSynthesis.speak(u); }catch{} };
document.getElementById('voiceBtn').onclick = async ()=>{
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SR) return toast("Voice not supported in this browser.");
  const r = new SR(); r.lang="en-AU"; r.continuous=false;
  r.onresult = e=>{
    const q = e.results[0][0].transcript.toLowerCase();
    if(q.includes("revenue")){ speak(`Estimated monthly revenue is ${document.getElementById('revEst').textContent}`) }
    else if(q.includes("members")){ const k=computeKPIs(); speak(`We have ${k.total} members. ${k.act} are active.`) }
    else if(q.includes("dark")){ toggleTheme(); speak("Dark mode set.") }
    else if(q.includes("light")){ toggleTheme(true); speak("Light mode set.") }
    else if(q.includes("insight")){ setInsight(true); speak(document.getElementById('insight').textContent) }
    else{ speak("Try asking about revenue, members, or set dark mode.") }
  };
  r.start();
  toast("Listening‚Ä¶ Ask: ‚ÄúRevenue‚Äù, ‚ÄúMembers‚Äù, ‚ÄúDark mode‚Äù");
};

/* =========================================================
   INSIGHTS
   ========================================================= */
function setInsight(rand=false){
  const ideas = [
    "VIP cohort retention projected +18% with tailored recovery classes on weekdays 6‚Äì7pm.",
    "AI suggests upgrading engaged Premiums with ‚â• 5 sessions/week to VIP for +A$12K ARR.",
    "Attrition risk spikes 7‚Äì10 days pre-expiry; offer 10% renewal incentive to reduce churn by 22%.",
    "Peak floor load at 6:10pm; reallocate 1 staff from reception to coaching for 40 minutes.",
    "Introduce ‚ÄòStrength & Mobility Hybrid‚Äô to Basic tier; pilot shows +14% engagement uplift."
  ];
  document.getElementById('insight').textContent = ideas[Math.floor(Math.random()*ideas.length)];
}
document.getElementById('insightRefresh').onclick = ()=> setInsight(true);

/* =========================================================
   EXPORT / IMPORT / THEME / TOAST
   ========================================================= */
document.getElementById('exportCSV').onclick = ()=>{
  const headers = ["id","name","email","phone","membership_type","status","join_date","last_checkin","expiry_date"];
  const rows = MEMBERS.map(m=> headers.map(h=> `"${(m[h]??"").toString().replace(/"/g,'""')}"`).join(",") );
  const blob = new Blob([headers.join(",")+"\n"+rows.join("\n")], {type:"text/csv"});
  const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download="fitzone-members.csv"; a.click();
};
document.getElementById('downloadJSON').onclick = ()=>{
  const blob = new Blob([JSON.stringify(MEMBERS,null,2)], {type:"application/json"});
  const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download="fitzone-members.json"; a.click();
};
document.getElementById('importJSON').onclick = ()=> document.getElementById('fileJSON').click();
document.getElementById('fileJSON').onchange = async (e)=>{
  const f = e.target.files[0]; if(!f) return;
  try{
    const text = await f.text(); const arr = JSON.parse(text);
    if(Array.isArray(arr)){ MEMBERS=arr; saveMembers(MEMBERS); renderAll(); toast("Imported successfully."); }
    else toast("Invalid JSON (expected array)");
  }catch{ toast("Invalid JSON file") }
  e.target.value="";
};
let LIGHT=false;
function toggleTheme(forceLight){
  if(typeof forceLight==='boolean') LIGHT = forceLight; else LIGHT=!LIGHT;
  document.body.style.background = LIGHT ? "#f5f7fb" : "";
  document.body.style.color = LIGHT ? "#0a0d12" : "";
  // Chart text colors will adapt on next redraw; redraw quickly:
  drawCharts();
}
document.getElementById('theme').onclick = ()=> toggleTheme();

const toastEl = document.getElementById('toast');
function toast(msg){ toastEl.textContent=msg; toastEl.style.display='block'; clearTimeout(toastEl._t); toastEl._t=setTimeout(()=>toastEl.style.display='none', 2400) }

/* =========================================================
   SIMULATION (Check-ins + Micro-pulses)
   ========================================================= */
let sim=null;
document.getElementById('simulateCheckins').onclick = ()=>{
  if(sim) return;
  sim = setInterval(()=>{
    const m = MEMBERS[Math.floor(Math.random()*MEMBERS.length)];
    m.last_checkin = fmt(new Date()); saveMembers(MEMBERS);
    CHECKINS.push({id:m.id, ts:new Date().toISOString()}); saveCheckins(CHECKINS);
    // subtle KPI pulse
    renderKPIs();
  }, 900);
  toast("Simulating check-ins‚Ä¶");
};
document.getElementById('stopSim').onclick = ()=>{ clearInterval(sim); sim=null; toast("Simulation stopped."); };
document.getElementById('simulatePulse').onclick = ()=>{
  SERIES[Math.floor(Math.random()*SERIESS().length)].active += 20+Math.floor(Math.random()*60);
  SERIES[Math.floor(Math.random()*SERIESS().length)].calories += 2000+Math.floor(Math.random()*7000);
  drawCharts(); toast("Pulse injected.");
};
document.getElementById('reseed').onclick = ()=>{
  if(!confirm("Reseed demo data? This overwrites local changes.")) return;
  MEMBERS = seedMembers(220); CHECKINS=[]; saveCheckins(CHECKINS);
  renderAll(); toast("Demo reseeded.");
};

/* =========================================================
   PLAN FILTER
   ========================================================= */
document.querySelectorAll('[data-plan]').forEach(p=>p.addEventListener('click',()=>{
  document.querySelectorAll('[data-plan]').forEach(x=>x.classList.remove('active'));
  p.classList.add('active'); PLAN_FILTER = p.dataset.plan; drawCharts();
}));

/* =========================================================
   HELPER: RENDER ALL
   ========================================================= */
function renderAll(){
  renderKPIs();
  renderExpiries();
  renderDirectory();
  SERIES = genMonthly();
  drawCharts();
  setInsight(true);
}
renderAll();
</script>
</body>
</html>
